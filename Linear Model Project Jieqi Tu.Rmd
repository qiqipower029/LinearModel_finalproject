---
title: "Linear Model Project"
author: "Jieqi Tu (jtu22)"
date: "11/30/2020"
output: pdf_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
library(tidyverse)
library(ellipse)
```

## Question 1
In this problem, Let $\textbf{y}$ denote stiffness ($lb/in^2$) and $\textbf{X}$ denote the design matrix. We want to investigate the relationship between stiffness and density($lb/ft^3$). Since here we have 30 observations, and we only have one predictor and one outcome, the dimension of $\textbf{y}$ is $30\times 1$ and the dimension of $\textbf{X}$ is $30 \times 2$.
Then we have:
$${\textbf{y}}=\begin{bmatrix} 
2622\\ 22148\\ 26751\\ 18036\\ 96305\\ \vdots\\ 49499\\ 25312\\
\end{bmatrix}_{30\times1}$$\
$$\textbf{X}=\begin{bmatrix} 
1 & 15.0\\ 1 & 14.5\\ 1 & 14.8\\ 1 & 13.6\\ 1 & 25.6\\ \vdots & \vdots\\ 1 & 16.7\\ 1 & 15.4\\
\end{bmatrix}_{30\times 2}$$\
Here the first column in the design matrix allows estimation of the y-intercept and the second column contains the values of our variable (density).\
Then we construct a linear model:
$$\textbf{y}=\mathbf{X} \boldsymbol{\beta + \epsilon}$$
Here, we also have:
$$\boldsymbol{\beta}=
\begin{bmatrix} 
\beta_0\\ \beta_1\\
\end{bmatrix}_{2\times 1}$$
$$\boldsymbol{\epsilon}=\begin{bmatrix} 
\epsilon_1\\ \epsilon_2\\  \vdots\\  \epsilon_{30}\\
\end{bmatrix}_{30\times1}$$
Here we also assume that $$\boldsymbol{\epsilon}\sim N(0, \sigma^2)$$
Before running into questions, we firstly want to show $$result1: \textbf{X}^{'} \textbf{X} = \begin{bmatrix} 
30 & 464.1\\ 464.1 & 8166.29 \end{bmatrix}$$
$$result2:(\textbf{X}^{'} \textbf{X})^{-1}=\begin{bmatrix} 
0.2758892 & -0.0156791\\ -0.0156791 & 0.001013517 \end{bmatrix}$$
$$result3:\textbf{X}^{'} \textbf{y} = \begin{bmatrix}1017405\\19589339\end{bmatrix}$$
$$result 4:s^2=165242295.59$$

Below is my code to show these four results.
```{r q1 show}
# Import data
x = c(rep(1, 30), 15.0, 14.5, 14.8, 13.6, 25.6, 23.4, 24.4, 23.3, 19.5, 21.2, 22.8, 21.7, 19.8, 21.3, 9.5,
      8.4, 9.8, 11.0, 8.3, 9.9, 8.6, 6.4, 7.0, 8.2, 17.4, 15.0, 15.2, 16.4, 16.7, 15.4)
y = c(2622, 22148, 26751, 18036, 96305, 104170, 72594, 49512, 32207, 48218, 70453, 47661, 38138, 54045, 14814,
      17502, 14007, 19443, 7573, 14191, 9714, 8076, 5304, 10728, 43243, 25319, 28028, 41792, 49499, 25312)

# Create design matrix
x.matrix = matrix(x, ncol = 2, nrow = 30, byrow = F)

# Result 1
result1 = t(x.matrix) %*% x.matrix
result1

# Result 2
solve(result1)

# Result 3
t(x.matrix) %*% y

# Result 4
density = c(15.0, 14.5, 14.8, 13.6, 25.6, 23.4, 24.4, 23.3, 19.5, 21.2, 22.8, 21.7, 19.8, 21.3, 9.5,
            8.4, 9.8, 11.0, 8.3, 9.9, 8.6, 6.4, 7.0, 8.2, 17.4, 15.0, 15.2, 16.4, 16.7, 15.4)
data = data.frame(y, density)
model1 = lm(y~density, data = data)
summary(model1)$sigma^2
```

All these four results are confirmed. 

#### (a)
Estimate $\boldsymbol{\beta}$.
```{r q1 a}
# Fit a linear model
model1 = lm(y~density, data = data)
summary(model1)
```

From the result, we could see that, the estimates of $\boldsymbol{\beta}$ are: $\beta_0=-26452.4,\beta_1=3902.1$. The p-values for these two estimates are both less than 0.001, which indicates that they are significant different from 0.

#### (b)
Find a point estimate for the mean stiffness reading when the density of the particleboard is 10 $lb/ft^3$. Find a 95% confidence interval on this mean reading.
```{r q1 b}
newdata = data.frame(
  density = 10
)
predict(model1, newdata = newdata, interval = "confidence")
```
So the point estimate for the stiffness reading when density = 10 is 12568.87 $lb/in^2$.
The 95% confidence interval of the point estimate is [5925.235, 19212.5].

#### (c)
Find a point estimate for the stiffness reading of an individual particleboard whose density is 10 $lb/ft^3$. Find a 95% prediction interval on the stiffness reading for such a board.
```{r q1 c}
newdata = data.frame(
  density = 10
)
predict(model1, newdata = newdata, interval = "prediction")
```
The point estimate is the same as what has been shown in part (b). The 95% prediction interval for this individual is [-14587.9, 39725.63]

#### (d)
Find a 95% confidence interval on the slope of the regression line.
```{r q1 d}
# Calculate the confidence interval for the slope of the regression line
confint(model1, 'density', level = 0.95)
```
The 95% confidence interval on the slope of the regression line is [3063.87, 4740.413].

#### (e)
Find a 95% joint confidence region on the pair of parameters $(\beta_0, \beta_1)$.
Here the $H_0:\boldsymbol{\beta}=\boldsymbol{\hat \beta}$.
Then the confidence for $\boldsymbol{\beta}$ is:
$$c_{\alpha}=\frac{(\hat{\boldsymbol{\beta}}-\boldsymbol{\beta})'(\boldsymbol{X'X})^{-1}(\hat{\boldsymbol{\beta}}-\boldsymbol{\beta})}{\sigma^2}\leq F_{0.05,2,28}$$.
Solve this inequality, we will get the confidence region for $\beta_0, \beta_1$. It will be of an elliptical form.
```{r q1 e}
# Calculate joint 95% confidence region
plot(ellipse(model1, level = 0.95, type = "l"))
```

The pairwise confidence region is plotted (using 100 scatter points).

## Question 2
Let $\textbf{y}=\mathbf{X} \boldsymbol{\beta + \epsilon}$ where
$$\boldsymbol{X}=\begin{bmatrix} 
1 & 1 & 0 & 0\\ 1 & 1 & 0 & 0\\ 1 & 0 & 1 & 0\\ 1 & 0 & 1 & 0\\ 1 & 0 & 0 & 1\\ 1 & 0 & 0 & 1\\
\end{bmatrix}_{6\times 4}$$
$$\textbf{y}=\begin{bmatrix} 
3\\ 1 \\ 2\\ 2\\ 0\\ 4\\
\end{bmatrix}_{6\times 1}$$

#### (a)
Find $\textbf{X}^{'} \textbf{X}$ and show that $r(\textbf{X}^{'} \textbf{X})=3$
```{r q2 a}
# Import data
x = matrix(c(1, 1, 0, 0,
             1, 1, 0, 0,
             1, 0, 1, 0,
             1, 0, 1, 0,
             1, 0, 0, 1,
             1, 0, 0, 1), nrow = 6, ncol = 4, byrow = T)

# Find X'X
t(x) %*% x
```

Since we have 3 pairs of identical rows in the matrix, only 3 rows are linearly independent (They cannot be expressed by the linear combination of other rows).We can also verify this by R:
```{r q2 a2}
# Find the rank of X
library(Matrix)
rankMatrix(x)[[1]]
```


#### (b)
Show that the system of normal equations is consistent.
The normal equation is: $\boldsymbol{X'X \beta}=\boldsymbol{X'y}$.
To show this system is consistent, we need to show that $\boldsymbol{X'y}$ falls into the column space of $\boldsymbol{X'X}$.
It is sufficient to show that $rank(\boldsymbol{X'X|X'y})\leq rank(\boldsymbol{X'X})$.
```{r q2 b}
# Construct matrix
y = matrix(c(3, 1, 2, 2, 0, 4),
           nrow = 6, ncol = 1)
Xprime.y = t(x) %*% y
Xprime.x = t(x) %*% x

# Create matrix X'X|X'y
XprimeX.XprimeY = cbind(Xprime.x, Xprime.y)

# Compare the rank of X'X|X'y and X'X
rankMatrix(XprimeX.XprimeY)[[1]]
rankMatrix(Xprime.x)[[1]]
```

From the results, we could see that $rank(\boldsymbol{X'X|X'y})= rank(\boldsymbol{X'X})$.
Therefore, the system of normal equations is consistent.

#### (c)

